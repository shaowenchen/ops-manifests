apiVersion: crd.chenshaowen.com/v1
kind: Pipeline
metadata:
  name: delete-pod-not200-bysvcmetrics
  namespace: ops-system
  labels:
    ops/copilot: enabled
spec:
  desc: Query Pod non-200 metrics by service to determine if Pod should be deleted
  variables:
    pod:
      desc: pod name
      required: false
  tasks:
    - name: get-pod-not200-metrics-by-svc
      desc: Get pod not 200 metrics by service
      taskRef: get-metrics-pod-not200-bysvc
    - name: get-pod-not200-increment-metrics
      desc: Get pod not 200 increment metrics
      taskRef: get-metrics-pod-not200
    - name: delete-abnormal-metric-pod
      desc: Delete pod with abnormal metrics
      taskRef: delete-pod-bycounts
